<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>ull-esit-inf-dsi-23-24-prct13-dsikea-api-grouph</title><meta name="description" content="Documentation for ull-esit-inf-dsi-23-24-prct13-dsikea-api-grouph"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">ull-esit-inf-dsi-23-24-prct13-dsikea-api-grouph</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h2>ull-esit-inf-dsi-23-24-prct13-dsikea-api-grouph</h2></div><div class="tsd-panel tsd-typography"><a id="md:práctica-13---dsikea-api-rest-con-nodeexpress" class="tsd-anchor"></a><h1><a href="#md:práctica-13---dsikea-api-rest-con-nodeexpress">Práctica 13 - DSIkea: API REST con Node/Express</a></h1><ul>
<li><p><strong>Grupo H</strong></p>
<ul>
<li>Francisco Felipe Martín Vide</li>
<li>Emilio González Díaz</li>
<li>Laura Álvarez Zamora</li>
</ul>
</li>
<li><p>Desarrollo de Sistemas Informáticos</p>
</li>
<li><p>Grado en Ingeniería Informática</p>
</li>
<li><p>Universidad de La Laguna</p>
</li>
<li><p><strong>Ejecución del programa:</strong></p>
<ul>
<li>sudo /home/usuario/mongodb/bin/mongod --dbpath /home/usuario/mongodb-data/</li>
<li>npm run build</li>
<li>npm run dev</li>
</ul>
</li>
</ul>
<p align="center">
    <a href='https://coveralls.io/github/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct13-dsikea-api-grouph?branch=main'>
        <img src='https://coveralls.io/repos/github/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct13-dsikea-api-grouph/badge.svg?branch=main' alt='Coverage Status'/>
    </a>
    <a href = "https://github.com/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct13-dsikea-api-grouph/actions/workflows/node.js.yml">
        <img alt="Github" src="https://github.com/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct13-dsikea-api-grouph/actions/workflows/node.js.yml/badge.svg?branch=main">
    </a>
    <a href = "https://sonarcloud.io/summary/new_code?id=ULL-ESIT-INF-DSI-2324_ull-esit-inf-dsi-23-24-prct13-dsikea-api-grouph">
        <img alt = "Quality gate" src="https://sonarcloud.io/api/project_badges/measure?project=ULL-ESIT-INF-DSI-2324_ull-esit-inf-dsi-23-24-prct13-dsikea-api-grouph&metric=alert_status">
    </a>
</p>

<a id="md:introducción-y-objetivos" class="tsd-anchor"></a><h2><a href="#md:introducción-y-objetivos">Introducción y objetivos</a></h2><p>En esta segunda práctica grupal, se nos ha pedido desarrollar un <strong>API REST</strong> haciendo uso de NodeJS y Express para poder llevar a cabo la correcta gestión de una tienda de muebles. Ésta aplicación deberá poder llevar a cabo operaciones de creación, lectura, modificación y borrado de tanto clientes, proveedores, muebles y transacciones.</p>
<p>Para poder llevar a cabo este proyecto, también será necesario que nos familiaricemos con las plataformas <code>MongoDB Atlas</code> para alojar la base de datos en la nube, y <code>Render</code>, para poder implementar la API en un entorno cloud.</p>
<p>Además, tendremos que seguir la meotodlogía <code>TDD</code> (<strong>Test Driven Development</strong>), lo que significa que también deberemos llevar a cabo un conjunto de pruebas unitarias para las diferentes funcionalidades del programa. 
Por último, también haremos uso de <strong>Typedoc</strong> para generar la documentación de nuestros métodos de forma &quot;automática&quot;, además de otras herramientas como <code>c8</code> y <code>coveralls</code>, para llevar a cabo el cubrimiento de nuestro código y la visualización del mismo, y <code>Sonar Cloud</code> para comprobar la calidad y seguridad del código fuente desarrollado.</p>
<p>El enunciado de proyecto en el que se explican todos los requisitos que debe cumplir, lo podemos encontrar <a href="https://ull-esit-inf-dsi-2324.github.io/prct13-DSIkea-api/">aquí</a>.</p>
<a id="md:desarrollo" class="tsd-anchor"></a><h2><a href="#md:desarrollo">Desarrollo</a></h2><p>En este apartado llevaremos a cabo la explicación del código desarrollado. Sin embargo, antes de pasar con el código como tal, queremos resaltar la importancia de las variables de entorno definidas en los ficheros dentro del directiorio <code>./config</code>. Estas variables son esenciales para diferenciar entre los entornos de producción y de pruebas, permitiendo una gestión más segura y eficiente de la configuración sin comprometer datos sensibles.</p>
<ul>
<li><strong>dev.env</strong></li>
</ul>
<pre><code><span class="hl-0">PORT</span><span class="hl-1">=</span><span class="hl-2">3000</span><br/><span class="hl-0">MONGODB_URL</span><span class="hl-1">=</span><span class="hl-3">mongodb</span><span class="hl-1">:</span><span class="hl-4">mongodb</span><span class="hl-1">+</span><span class="hl-3">srv</span><span class="hl-1">:</span><span class="hl-5">//dsikea-rest-api:ikeaDSI@dsikearestapicluster.pmd2rld.mongodb.net/ikea-api</span>
</code><button>Copy</button></pre>
<ul>
<li><strong>test.env</strong></li>
</ul>
<pre><code><span class="hl-0">PORT</span><span class="hl-1">=</span><span class="hl-2">3000</span><br/><span class="hl-0">MONGODB_URL</span><span class="hl-1">=</span><span class="hl-3">mongodb</span><span class="hl-1">:</span><span class="hl-5">//127.0.0.1:27017/dsikea-api</span>
</code><button>Copy</button></pre>
<p>A continuación, procederemos con todo el código desarrollado dentro de los directorios contenidos en <code>./src</code>.</p>
<a id="md:srcdb" class="tsd-anchor"></a><h3><a href="#md:srcdb"><strong>[./src/db]</strong></a></h3><p> Dentro de este directorio, nos encontramos con el fichero <code>mongoose.ts</code>, el cual contiene el código necesario para establecer la conexión con el servidor de MongoDB. </p>
<pre><code><span class="hl-6">try</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-7">connect</span><span class="hl-1">(</span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-4">env</span><span class="hl-1">.</span><span class="hl-0">MONGODB_URL</span><span class="hl-1">!);</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-8">&#39;Connection to MongoDB server established&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">} </span><span class="hl-6">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">   </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p> Este fichero importa la función connect del módulo mongoose y utiliza una variable de entorno <strong>process.env.MONGODB_URL</strong> para acceder a la URL de conexión a la base de datos. </p>
<p>Por otro lado, en el fichero <code>index.ts</code> nos encontramos con el núcleo de la configuración del servidor usando el framework Express. Este fichero es crucial ya que actúa como punto de entrada para la aplicación, donde se inicializa el servidor HTTP y se configuran las rutas y los middlewares necesarios para el funcionamiento de la aplicación.</p>
<pre><code><span class="hl-6">export</span><span class="hl-1"> </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">app</span><span class="hl-1"> = </span><span class="hl-7">express</span><span class="hl-1">();</span><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-7">disable</span><span class="hl-1">(</span><span class="hl-8">&#39;x-powered-by&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">port</span><span class="hl-1"> = </span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-4">env</span><span class="hl-1">.</span><span class="hl-0">PORT</span><span class="hl-1"> || </span><span class="hl-2">3000</span><span class="hl-1">;</span><br/><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-7">use</span><span class="hl-1">(</span><span class="hl-4">express</span><span class="hl-1">.</span><span class="hl-7">json</span><span class="hl-1">());</span><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-7">use</span><span class="hl-1">(</span><span class="hl-4">customerRouter</span><span class="hl-1">);</span><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-7">use</span><span class="hl-1">(</span><span class="hl-4">providerRouter</span><span class="hl-1">);</span><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-7">use</span><span class="hl-1">(</span><span class="hl-4">furnitureRouter</span><span class="hl-1">);</span><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-7">use</span><span class="hl-1">(</span><span class="hl-4">transactionRouter</span><span class="hl-1">);</span><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-7">use</span><span class="hl-1">(</span><span class="hl-4">defaultRouter</span><span class="hl-1">);</span><br/><br/><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-7">listen</span><span class="hl-1">(</span><span class="hl-4">port</span><span class="hl-1">, () </span><span class="hl-9">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-8">`Server is up on port </span><span class="hl-9">${</span><span class="hl-4">port</span><span class="hl-9">}</span><span class="hl-8">`</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>El servidor se configura para escuchar en un puerto definido por una variable de entorno <strong>PORT</strong>, o el puerto 3000 como predeterminado. Al iniciar el servidor, se imprime un mensaje en la consola indicando que el servidor está operativo y escuchando peticiones en el puerto especificado.</p>
<a id="md:srcmodels" class="tsd-anchor"></a><h3><a href="#md:srcmodels"><strong>[./src/models]</strong></a></h3><p>En este directorio encontraremos las diferentes interfaces y modelos utilizados en la aplicación, cada uno correspondiente a las entidades de la base de datos como clientes, proveedores, muebles y transacciones. Cada modelo está definido utilizando Mongoose, lo que facilita la integración con MongoDB al proporcionar una estructura de datos clara.</p>
<ul>
<li><strong>customer.ts</strong></li>
</ul>
<p>En este archivo, definimos <code>CustomerDocumentInterface</code> como una interfaz que extiende <code>Document</code> de Mongoose, lo que permite tipificar los documentos de la colección de clientes. Los campos incluidos en esta interfaz son:</p>
<ul>
<li><code>name</code>: Nombre del cliente, requerido y sin espacios al inicio o al final.</li>
<li><code>nif</code>: Número de Identificación Fiscal, que debe ser único y seguir un formato específico (8 dígitos seguidos de una letra).</li>
<li><code>email</code>: Dirección de correo electrónico, requerida, que se convierte a minúsculas y se valida para asegurar que tiene un formato de correo válido.</li>
<li><code>mobilePhone</code>: Número de teléfono móvil opcional, que debe tener exactamente 9 dígitos.</li>
<li><code>address</code>: Dirección del cliente, requerida y sin espacios al inicio o al final.</li>
</ul>
<p>El <strong>customerSchema</strong> aplica estas definiciones y añade validaciones específicas para asegurar que los datos ingresados cumplen con las políticas de nuestra aplicación. La instancia del modelo <strong>Customer</strong> se crea basándose en este esquema, permitiendo interactuar con la colección de clientes en la base de datos.</p>
<pre><code><span class="hl-1">  </span><span class="hl-6">export</span><span class="hl-1"> </span><span class="hl-9">interface</span><span class="hl-1"> </span><span class="hl-10">CustomerDocumentInterface</span><span class="hl-1"> </span><span class="hl-9">extends</span><span class="hl-1"> </span><span class="hl-10">Document</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">name</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">nif</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">email</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">mobilePhone</span><span class="hl-1">?: </span><span class="hl-10">number</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">address</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">,</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">customerSchema</span><span class="hl-1"> = </span><span class="hl-9">new</span><span class="hl-1"> </span><span class="hl-7">Schema</span><span class="hl-1">&lt;</span><span class="hl-10">CustomerDocumentInterface</span><span class="hl-1">&gt;({</span><br/><span class="hl-1">      </span><span class="hl-4">name:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-9">true</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">trim:</span><span class="hl-1"> </span><span class="hl-9">true</span><span class="hl-1">,</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-4">nif:</span><span class="hl-1"> { </span><br/><span class="hl-1">          </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">, </span><br/><span class="hl-1">          </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-9">true</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">unique:</span><span class="hl-1"> </span><span class="hl-9">true</span><span class="hl-1">, </span><br/><span class="hl-1">          </span><span class="hl-4">trim:</span><span class="hl-1"> </span><span class="hl-9">true</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">validate:</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-7">validator</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-9">function</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">) {</span><br/><span class="hl-1">              </span><span class="hl-6">if</span><span class="hl-1"> (!</span><span class="hl-11">/</span><span class="hl-12">^</span><span class="hl-13">[</span><span class="hl-11">0-9</span><span class="hl-13">]</span><span class="hl-14">{8}</span><span class="hl-13">[</span><span class="hl-11">A-Z</span><span class="hl-13">]</span><span class="hl-12">$</span><span class="hl-11">/</span><span class="hl-9">i</span><span class="hl-1">.</span><span class="hl-7">test</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">)) {</span><br/><span class="hl-1">                </span><span class="hl-6">throw</span><span class="hl-1"> </span><span class="hl-9">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-8">&#39;NIF must have 8 digits followed by a letter and be exactly 9 characters long&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">              }</span><br/><span class="hl-1">              </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-9">true</span><span class="hl-1">;</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-4">email:</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-9">true</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">trim:</span><span class="hl-1"> </span><span class="hl-9">true</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">lowercase:</span><span class="hl-1"> </span><span class="hl-9">true</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-7">validate</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-6">if</span><span class="hl-1"> (!</span><span class="hl-4">validator</span><span class="hl-1">.</span><span class="hl-4">default</span><span class="hl-1">.</span><span class="hl-7">isEmail</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">)) {</span><br/><span class="hl-1">              </span><span class="hl-6">throw</span><span class="hl-1"> </span><span class="hl-9">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-8">&#39;Email is invalid&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-4">mobilePhone:</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-9">false</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-7">validate</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1">.</span><span class="hl-7">toString</span><span class="hl-1">().</span><span class="hl-4">length</span><span class="hl-1"> !== </span><span class="hl-2">9</span><span class="hl-1">) {</span><br/><span class="hl-1">              </span><span class="hl-6">throw</span><span class="hl-1"> </span><span class="hl-9">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-8">&#39;Mobile phone must have 9 digits&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-4">address:</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-9">true</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">trim:</span><span class="hl-1"> </span><span class="hl-9">true</span><span class="hl-1">,</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">  });</span><br/><br/><span class="hl-1">  </span><span class="hl-6">export</span><span class="hl-1"> </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">Customer</span><span class="hl-1"> = </span><span class="hl-7">model</span><span class="hl-1">&lt;</span><span class="hl-10">CustomerDocumentInterface</span><span class="hl-1">&gt;(</span><span class="hl-8">&#39;Customer&#39;</span><span class="hl-1">, </span><span class="hl-4">customerSchema</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<ul>
<li><strong>provider.ts</strong></li>
</ul>
<p> Similar al archivo de clientes, <code>ProviderDocumentInterface</code> define la estructura para los documentos de proveedores en la base de datos. Los campos son paralelos a los de clientes, con la diferencia principal en el campo <strong>cif</strong>, que es el número de identificación fiscal para proveedores y debe seguir el patrón de una letra seguida de 8 dígitos.</p>
<p> El <code>providerSchema</code> incluye validaciones similares a las del esquema de clientes para garantizar la integridad de los datos. Por ejemplo, el <strong>CIF</strong> debe ser único y seguir el formato específico mencionado, y el <strong>email</strong> debe ser válido. Al igual que en el modelo de clientes, se crean instancias del modelo <strong>Provider</strong> basadas en este esquema para realizar operaciones de base de datos relacionadas con proveedores.</p>
<ul>
<li><strong>furniture.ts</strong></li>
</ul>
<p> Primero, definimos la interfaz <code>FurnitureDocumentInterface</code>, que extiende la interfaz <code>Document</code> de Mongoose. Esta interfaz especifica los campos que cada documento de mobiliario debe contener:</p>
<ul>
<li><code>name</code>: Nombre del mueble, que es único y requerido.</li>
<li><code>description</code>: Descripción detallada del mueble, también requerida.</li>
<li><code>material</code>: Material del que está hecho el mueble, requerido.</li>
<li><code>color</code>: Color del mueble, limitado a opciones específicas como &#39;rojo&#39;, &#39;azul&#39;, etc.</li>
<li><code>price</code>: Precio del mueble, que debe ser mayor que 0 para asegurar datos comerciales válidos.</li>
<li><code>type</code>: Tipo de mueble, como &#39;Silla&#39;, &#39;Mesa&#39; o &#39;Armario&#39;.</li>
<li><code>stock</code>: Cantidad de inventario disponible, que no puede ser negativa para mantener la validez del mismo.</li>
</ul>
<p> Luego, definimos el <code>furnitureSchema</code>, que es una instancia del Schema de Mongoose, aplicando la interfaz <code>FurnitureDocumentInterface</code> para asegurar que todos los documentos de mobiliario en la base de datos se adhieran a las especificaciones de tipo y validación. El esquema:</p>
<ul>
<li>Impone que el nombre sea único y esté libre de espacios innecesarios (trim).</li>
<li>Utiliza validaciones para asegurar que el precio y el stock sean lógicos.</li>
<li>Restringe los valores de color y type a conjuntos predefinidos.</li>
</ul>
<pre><code><span class="hl-6">export</span><span class="hl-1"> </span><span class="hl-9">interface</span><span class="hl-1"> </span><span class="hl-10">FurnitureDocumentInterface</span><span class="hl-1"> </span><span class="hl-9">extends</span><span class="hl-1"> </span><span class="hl-10">Document</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">name</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">description</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">material</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">color</span><span class="hl-1">: </span><span class="hl-8">&#39;rojo&#39;</span><span class="hl-1"> | </span><span class="hl-8">&#39;azul&#39;</span><span class="hl-1"> | </span><span class="hl-8">&#39;verde&#39;</span><span class="hl-1"> | </span><span class="hl-8">&#39;amarillo&#39;</span><span class="hl-1"> | </span><span class="hl-8">&#39;negro&#39;</span><span class="hl-1"> | </span><span class="hl-8">&#39;blanco&#39;</span><span class="hl-1"> | </span><span class="hl-8">&#39;marron&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">price</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">type</span><span class="hl-1">: </span><span class="hl-8">&#39;Silla&#39;</span><span class="hl-1"> | </span><span class="hl-8">&#39;Mesa&#39;</span><span class="hl-1"> | </span><span class="hl-8">&#39;Armario&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">stock</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">,</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-6">export</span><span class="hl-1"> </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">furnitureSchema</span><span class="hl-1"> = </span><span class="hl-9">new</span><span class="hl-1"> </span><span class="hl-7">Schema</span><span class="hl-1">&lt;</span><span class="hl-10">FurnitureDocumentInterface</span><span class="hl-1">&gt;({</span><br/><span class="hl-1">    </span><span class="hl-4">name:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-9">true</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">unique:</span><span class="hl-1"> </span><span class="hl-9">true</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">trim:</span><span class="hl-1"> </span><span class="hl-9">true</span><span class="hl-1">,</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">description:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-9">true</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">trim:</span><span class="hl-1"> </span><span class="hl-9">true</span><span class="hl-1">,</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">material:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-9">true</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">trim:</span><span class="hl-1"> </span><span class="hl-9">true</span><span class="hl-1">,</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">color:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-9">true</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">enum:</span><span class="hl-1"> [</span><span class="hl-8">&#39;rojo&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;azul&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;verde&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;amarillo&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;negro&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;blanco&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;marron&#39;</span><span class="hl-1">],</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">price:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-9">true</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-7">validate</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> &lt;= </span><span class="hl-2">0</span><span class="hl-1">) {</span><br/><span class="hl-1">                </span><span class="hl-6">throw</span><span class="hl-1"> </span><span class="hl-9">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-8">&#39;Price must be greater than 0&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-9">true</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">enum:</span><span class="hl-1"> [</span><span class="hl-8">&#39;Silla&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;Mesa&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;Armario&#39;</span><span class="hl-1">],</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">stock:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-9">true</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-7">validate</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> &lt; </span><span class="hl-2">0</span><span class="hl-1">) {</span><br/><span class="hl-1">                </span><span class="hl-6">throw</span><span class="hl-1"> </span><span class="hl-9">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-8">&#39;Stock must be greater than or equal to 0&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-6">export</span><span class="hl-1"> </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">Furniture</span><span class="hl-1"> = </span><span class="hl-7">model</span><span class="hl-1">&lt;</span><span class="hl-10">FurnitureDocumentInterface</span><span class="hl-1">&gt;(</span><span class="hl-8">&#39;Furniture&#39;</span><span class="hl-1">, </span><span class="hl-4">furnitureSchema</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<ul>
<li><strong>transaction.ts</strong></li>
</ul>
<p>La interfaz <code>TransactionDocumentInterface</code> extiende la interfaz básica <code>Document</code> de Mongoose, proporcionando una estructura tipada para los documentos de transacciones. Los campos definidos en esta interfaz son:</p>
<ul>
<li><code>customerNIF</code>: Número de Identificación Fiscal del cliente, opcional, requerido cuando la transacción es una venta.</li>
<li><code>providerCIF</code>: Código de Identificación Fiscal del proveedor, opcional, necesario cuando la transacción es una compra.</li>
<li><code>type</code>: Tipo de transacción, que puede ser &#39;SALE&#39; (venta) o &#39;PURCHASE&#39; (compra), es un campo requerido.</li>
<li><code>furnitureList</code>: Lista de muebles involucrados en la transacción, incluyendo un identificador de mueble y la cantidad. Cada mueble se referencia por su ID y debe tener al menos una unidad.</li>
<li><code>totalPrice</code>: Precio total de la transacción, que debe ser mayor que cero para asegurar su validez.</li>
<li><code>date</code>: Fecha de la transacción, que se registra automáticamente al crear el documento.</li>
</ul>
<p>El <code>transactionSchema</code> aplica la interfaz <code>TransactionDocumentInterface</code> para definir las reglas de validación y estructura de los documentos de transacción en la base de datos:</p>
<ul>
<li>Los campos <code>customerNIF</code> y <code>providerCIF</code> incluyen validaciones para asegurar que sigan el formato correcto y requeridos dependiendo del tipo de transacción.</li>
<li>El campo <code>type</code> restringe los valores a <strong>&#39;SALE&#39;</strong> o <strong>&#39;PURCHASE&#39;</strong>.</li>
<li><code>furnitureList</code> asegura que cada entrada de mueble tenga un identificador válido y una cantidad que sea un número entero y mayor o igual a uno.</li>
<li><code>totalPrice</code> y <code>date</code> también incluyen validaciones para garantizar que el precio sea positivo y que la fecha de transacción sea la actual al momento de crear el registro.</li>
</ul>
<p>Finalmente, se crea el modelo <code>Transaction</code> basado en el <code>transactionSchema</code> definido. Este modelo facilita la interacción con la colección <strong>&#39;transactions&#39;</strong> en la base de datos.</p>
<pre><code><span class="hl-6">export</span><span class="hl-1"> </span><span class="hl-9">interface</span><span class="hl-1"> </span><span class="hl-10">TransactionDocumentInterface</span><span class="hl-1"> </span><span class="hl-9">extends</span><span class="hl-1"> </span><span class="hl-10">Document</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">customerNIF</span><span class="hl-1">?: </span><span class="hl-10">string</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">providerCIF</span><span class="hl-1">?: </span><span class="hl-10">string</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">type</span><span class="hl-1">: </span><span class="hl-8">&#39;SALE&#39;</span><span class="hl-1"> | </span><span class="hl-8">&#39;PURCHASE&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">furnitureList</span><span class="hl-1">: { </span><span class="hl-4">furnitureId</span><span class="hl-1">: </span><span class="hl-10">FurnitureDocumentInterface</span><span class="hl-1"> | </span><span class="hl-10">number</span><span class="hl-1">; </span><span class="hl-4">quantity</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">} [],</span><br/><span class="hl-1">    </span><span class="hl-4">totalPrice</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">date</span><span class="hl-1">: </span><span class="hl-10">Date</span><span class="hl-1">,</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">transactionSchema</span><span class="hl-1"> = </span><span class="hl-9">new</span><span class="hl-1"> </span><span class="hl-7">Schema</span><span class="hl-1">&lt;</span><span class="hl-10">TransactionDocumentInterface</span><span class="hl-1">&gt;({</span><br/><span class="hl-1">    </span><span class="hl-4">customerNIF:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">trim:</span><span class="hl-1"> </span><span class="hl-9">true</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">validate:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-7">validator</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-9">function</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-6">if</span><span class="hl-1"> (!</span><span class="hl-11">/</span><span class="hl-12">^</span><span class="hl-13">[</span><span class="hl-11">0-9</span><span class="hl-13">]</span><span class="hl-14">{8}</span><span class="hl-13">[</span><span class="hl-11">A-Z</span><span class="hl-13">]</span><span class="hl-12">$</span><span class="hl-11">/</span><span class="hl-9">i</span><span class="hl-1">.</span><span class="hl-7">test</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">)) {</span><br/><span class="hl-1">            </span><span class="hl-6">throw</span><span class="hl-1"> </span><span class="hl-9">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-8">&#39;NIF must have 8 digits followed by a letter and be exactly 9 characters long&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">          </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-9">true</span><span class="hl-1">;</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-7">required</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-9">function</span><span class="hl-1">() {</span><br/><span class="hl-1">          </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-9">this</span><span class="hl-1">.</span><span class="hl-4">type</span><span class="hl-1"> === </span><span class="hl-8">&#39;SALE&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">providerCIF:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">trim:</span><span class="hl-1"> </span><span class="hl-9">true</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">validate:</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-7">validator</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-9">function</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">) {</span><br/><span class="hl-1">                </span><span class="hl-6">if</span><span class="hl-1"> (!</span><span class="hl-11">/</span><span class="hl-12">^</span><span class="hl-13">[</span><span class="hl-11">A-Z</span><span class="hl-13">][</span><span class="hl-11">0-9</span><span class="hl-13">]</span><span class="hl-14">{8}</span><span class="hl-12">$</span><span class="hl-11">/</span><span class="hl-9">i</span><span class="hl-1">.</span><span class="hl-7">test</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">)) {</span><br/><span class="hl-1">                    </span><span class="hl-6">throw</span><span class="hl-1"> </span><span class="hl-9">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-8">&#39;CIF must have 8 digits followed by a letter and be exactly 9 characters long&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">                }</span><br/><span class="hl-1">                </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-9">true</span><span class="hl-1">;</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">        </span><span class="hl-7">required</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-9">function</span><span class="hl-1">() {</span><br/><span class="hl-1">            </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-9">this</span><span class="hl-1">.</span><span class="hl-4">type</span><span class="hl-1"> === </span><span class="hl-8">&#39;PURCHASE&#39;</span><span class="hl-1">;</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">type:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">String</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-9">true</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">enum:</span><span class="hl-1"> [</span><span class="hl-8">&#39;SALE&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;PURCHASE&#39;</span><span class="hl-1">],</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">furnitureList:</span><span class="hl-1"> [{</span><br/><span class="hl-1">        </span><span class="hl-4">furnitureId:</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Types</span><span class="hl-1">.</span><span class="hl-4">ObjectId</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-4">ref:</span><span class="hl-1"> </span><span class="hl-8">&#39;Furniture&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-9">true</span><span class="hl-1">,</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">        </span><span class="hl-4">quantity:</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-9">true</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-4">min:</span><span class="hl-1"> </span><span class="hl-2">1</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-4">validate:</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-4">validator:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">.</span><span class="hl-4">isInteger</span><span class="hl-1">,</span><br/><span class="hl-1">                </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-8">&#39;Quantity must be an integer.&#39;</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">    }],</span><br/><span class="hl-1">    </span><span class="hl-4">totalPrice:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-9">true</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">default:</span><span class="hl-1"> </span><span class="hl-2">0</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-7">validate</span><span class="hl-1">(</span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-4">value</span><span class="hl-1"> &lt;= </span><span class="hl-2">0</span><span class="hl-1">) {</span><br/><span class="hl-1">                </span><span class="hl-6">throw</span><span class="hl-1"> </span><span class="hl-9">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-8">&#39;Total price must be greater than 0&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">date:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">type:</span><span class="hl-1"> </span><span class="hl-4">Date</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">required:</span><span class="hl-1"> </span><span class="hl-9">true</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">default:</span><span class="hl-1"> </span><span class="hl-4">Date</span><span class="hl-1">.</span><span class="hl-4">now</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">},  { </span><span class="hl-4">timestamps:</span><span class="hl-1"> </span><span class="hl-9">false</span><span class="hl-1"> },</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-6">export</span><span class="hl-1"> </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">Transaction</span><span class="hl-1"> = </span><span class="hl-7">model</span><span class="hl-1">&lt;</span><span class="hl-10">TransactionDocumentInterface</span><span class="hl-1">&gt;(</span><span class="hl-8">&#39;Transaction&#39;</span><span class="hl-1">, </span><span class="hl-4">transactionSchema</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<a id="md:srcrouters" class="tsd-anchor"></a><h3><a href="#md:srcrouters"><strong>[./src/routers]</strong></a></h3><p>En este directorio se encuentran definidos los <em>routers</em>, que son esenciales para dirigir las solicitudes entrantes a los controladores apropiados, dependiendo de la ruta y del tipo de solicitud HTTP que se realice. Los <em>routers</em> son los siguiente:</p>
<ul>
<li><strong>default.ts</strong></li>
</ul>
<p>Este fichero contiene un <em>router</em> genérico que maneja todas las solicitudes a rutas no definidas en el resto de <em>routers</em> de la aplicación. Es fundamental para manejar errores de forma centralizada y proporcionar una respuesta coherente cuando se accede a una ruta no configurada en el sistema.</p>
<pre><code><span class="hl-6">export</span><span class="hl-1"> </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">defaultRouter</span><span class="hl-1"> = </span><span class="hl-4">express</span><span class="hl-1">.</span><span class="hl-7">Router</span><span class="hl-1">();</span><br/><br/><span class="hl-4">defaultRouter</span><span class="hl-1">.</span><span class="hl-7">all</span><span class="hl-1">(</span><span class="hl-8">&#39;*&#39;</span><span class="hl-1">, (</span><span class="hl-4">_</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-9">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">501</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-8">&#39;Route not implemented&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<ul>
<li><strong>customer_router.ts</strong> y <strong>provider_router.ts</strong></li>
</ul>
<p>Las rutas para los clientes y los proveedores prácticamente iguales. Mientras que las rutas de clientes utilizan el NIF como identificador clave para realizar búsquedas, actualizaciones y eliminaciones, las rutas de proveedores utilizan el CIF, que es el equivalente para entidades comerciales o proveedores. Como los manejadores son prácticamente idénticos, en este apartado solo veremos los de los <code>customers</code>.</p>
<ul>
<li><code>POST /customers</code>: Permite crear un nuevo cliente en la base de datos. Recibe los datos del cliente en el cuerpo de la solicitud (name, NIF, email, mobilePhone, address) y crea una nueva instancia del modelo Customer con estos datos. Luego, guarda este objeto en la base de datos. Si el guardado tiene éxito, responde con un estado 201 junto con los datos del cliente creado, en caso contrario, devuelve un estado 500 con un mensaje de error.</li>
</ul>
<pre><code><span class="hl-4">customerRouter</span><span class="hl-1">.</span><span class="hl-7">post</span><span class="hl-1">(</span><span class="hl-8">&#39;/customers&#39;</span><span class="hl-1">, </span><span class="hl-9">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-9">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">customer</span><span class="hl-1"> = </span><span class="hl-9">new</span><span class="hl-1"> </span><span class="hl-7">Customer</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-4">customer</span><span class="hl-1">.</span><span class="hl-7">save</span><span class="hl-1">();</span><br/><span class="hl-1">        </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">201</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">customer</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-6">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<ul>
<li><code>PATCH /customers</code>: Permite actualizar los datos de un cliente existente mediante el uso de su NIF, que se proporciona como un parámetro de consulta. Los campos a actualizar se envían en el cuerpo de la solicitud, y solo ciertos campos están permitidos para modificación (name, email, mobilePhone, address). Se busca el cliente utilizando <strong>findOneAndUpdate</strong> para actualizarlo con los nuevos datos. Si la operación tiene éxito, se devuelven los datos actualizados; si el NIF está ausente, se envía un error 400, y si no se encuentra el cliente, se devuelve un error 404. Un error 500 se emite si ocurre un fallo en la operación.</li>
</ul>
<pre><code><span class="hl-4">customerRouter</span><span class="hl-1">.</span><span class="hl-7">patch</span><span class="hl-1">(</span><span class="hl-8">&#39;/customers&#39;</span><span class="hl-1">, </span><span class="hl-9">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-9">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">if</span><span class="hl-1">(!</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nif</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({</span><br/><span class="hl-1">            </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-8">&#39;NIF is required&#39;</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">allowedUpdates</span><span class="hl-1"> = [</span><span class="hl-8">&#39;name&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;email&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;mobilePhone&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;address&#39;</span><span class="hl-1">];</span><br/><span class="hl-1">    </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">actualUpdates</span><span class="hl-1"> = </span><span class="hl-4">Object</span><span class="hl-1">.</span><span class="hl-7">keys</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">isValidUpdate</span><span class="hl-1"> = </span><span class="hl-4">actualUpdates</span><span class="hl-1">.</span><span class="hl-7">every</span><span class="hl-1">((</span><span class="hl-4">update</span><span class="hl-1">) </span><span class="hl-9">=&gt;</span><span class="hl-1"> </span><span class="hl-4">allowedUpdates</span><span class="hl-1">.</span><span class="hl-7">includes</span><span class="hl-1">(</span><span class="hl-4">update</span><span class="hl-1">));</span><br/><br/><span class="hl-1">    </span><span class="hl-6">if</span><span class="hl-1">(!</span><span class="hl-4">isValidUpdate</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({</span><br/><span class="hl-1">            </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-8">&#39;Update is not allowed&#39;</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-6">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">customer</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-4">Customer</span><span class="hl-1">.</span><span class="hl-7">findOneAndUpdate</span><span class="hl-1">({ </span><span class="hl-4">nif:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nif</span><span class="hl-1"> }, </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">, { </span><span class="hl-4">new:</span><span class="hl-1"> </span><span class="hl-9">true</span><span class="hl-1">, </span><span class="hl-4">runValidators:</span><span class="hl-1"> </span><span class="hl-9">true</span><span class="hl-1"> });</span><br/><span class="hl-1">        </span><span class="hl-6">if</span><span class="hl-1">(!</span><span class="hl-4">customer</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><br/><span class="hl-1">                </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-8">&#39;Customer not found&#39;</span><span class="hl-1"> </span><br/><span class="hl-1">            });</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">customer</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-6">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<ul>
<li><code>PATCH /customers/:id</code>: Actualiza un cliente basado en su ID de MongoDB, pasado como parámetro de ruta. Similar a la ruta anterior, verifica que solo se actualicen los campos permitidos y luego utiliza <strong>findByIdAndUpdate</strong> para modificar el documento. Responde con los datos del cliente actualizado o con un error 400 si los campos son inválidos, 404 si no se encuentra al cliente, o 500 en caso de otros errores.</li>
</ul>
<pre><code><span class="hl-4">customerRouter</span><span class="hl-1">.</span><span class="hl-7">patch</span><span class="hl-1">(</span><span class="hl-8">&#39;/customers/:id&#39;</span><span class="hl-1">, </span><span class="hl-9">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-9">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">allowedUpdates</span><span class="hl-1"> = [</span><span class="hl-8">&#39;name&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;email&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;mobilePhone&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;address&#39;</span><span class="hl-1">];</span><br/><span class="hl-1">    </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">actualUpdates</span><span class="hl-1"> = </span><span class="hl-4">Object</span><span class="hl-1">.</span><span class="hl-7">keys</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">isValidUpdate</span><span class="hl-1"> = </span><span class="hl-4">actualUpdates</span><span class="hl-1">.</span><span class="hl-7">every</span><span class="hl-1">((</span><span class="hl-4">update</span><span class="hl-1">) </span><span class="hl-9">=&gt;</span><span class="hl-1"> </span><span class="hl-4">allowedUpdates</span><span class="hl-1">.</span><span class="hl-7">includes</span><span class="hl-1">(</span><span class="hl-4">update</span><span class="hl-1">));</span><br/><br/><span class="hl-1">    </span><span class="hl-6">if</span><span class="hl-1">(!</span><span class="hl-4">isValidUpdate</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({</span><br/><span class="hl-1">            </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-8">&#39;Update is not allowed&#39;</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-6">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">customer</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-4">Customer</span><span class="hl-1">.</span><span class="hl-7">findByIdAndUpdate</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">, </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">, { </span><span class="hl-4">new:</span><span class="hl-1"> </span><span class="hl-9">true</span><span class="hl-1">, </span><span class="hl-4">runValidators:</span><span class="hl-1"> </span><span class="hl-9">true</span><span class="hl-1"> });</span><br/><span class="hl-1">        </span><span class="hl-6">if</span><span class="hl-1">(!</span><span class="hl-4">customer</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><br/><span class="hl-1">                </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-8">&#39;Customer not found&#39;</span><span class="hl-1"> </span><br/><span class="hl-1">            });</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">customer</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-6">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<ul>
<li><code>GET /customers</code>: Recupera datos de un cliente utilizando su NIF como parámetro de consulta. Se utiliza <strong>findOne</strong> para buscar el cliente y devolver sus datos. Si falta el NIF en la solicitud, se responde con un error 400, mientras que un error 404 se devuelve si no se encuentra un cliente con el NIF dado. Los errores en la búsqueda se manejan con un estado 500.</li>
</ul>
<pre><code><span class="hl-4">customerRouter</span><span class="hl-1">.</span><span class="hl-7">get</span><span class="hl-1">(</span><span class="hl-8">&#39;/customers&#39;</span><span class="hl-1">, </span><span class="hl-9">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-9">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">if</span><span class="hl-1">(!</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nif</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({</span><br/><span class="hl-1">            </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-8">&#39;NIF is required&#39;</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-6">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">customer</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-4">Customer</span><span class="hl-1">.</span><span class="hl-7">findOne</span><span class="hl-1">({ </span><span class="hl-4">nif:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nif</span><span class="hl-1"> });</span><br/><span class="hl-1">        </span><span class="hl-6">if</span><span class="hl-1">(!</span><span class="hl-4">customer</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><br/><span class="hl-1">                </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-8">&#39;Customer not found&#39;</span><span class="hl-1"> </span><br/><span class="hl-1">            });</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">customer</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-6">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">    </span>
</code><button>Copy</button></pre>
<ul>
<li><code>GET /customers/:id</code>: Obtiene los datos de un cliente usando su ID de MongoDB. Utiliza <strong>findById</strong> para buscar al cliente, devolviendo sus datos en caso de éxito, o un error 404 si no se encuentra el cliente, y un error 500 en caso de problemas durante la operación.</li>
</ul>
<pre><code><span class="hl-4">customerRouter</span><span class="hl-1">.</span><span class="hl-7">get</span><span class="hl-1">(</span><span class="hl-8">&#39;/customers/:id&#39;</span><span class="hl-1">, </span><span class="hl-9">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-9">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">customer</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-4">Customer</span><span class="hl-1">.</span><span class="hl-7">findById</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-6">if</span><span class="hl-1">(!</span><span class="hl-4">customer</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><br/><span class="hl-1">                </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-8">&#39;Customer not found&#39;</span><span class="hl-1"> </span><br/><span class="hl-1">            });</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">customer</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-6">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<ul>
<li><code>DELETE /customers</code> y <code>DELETER /customers/:id</code>: Permiten eliminar un cliente usando su NIF o ID de MongoDB respectivamente. En ambos casos, se busca el cliente usando <strong>findOneAndDelete</strong> o <strong>findByIdAndDelete</strong>. Si el cliente se encuentra y se elimina con éxito, se devuelve un estado 200 con los datos del cliente eliminado. Se devuelve un estado 400 si falta el NIF o el ID, un error 404 si no se encuentra el cliente, y un error 500 en caso de fallos durante la operación.</li>
</ul>
<pre><code><span class="hl-4">customerRouter</span><span class="hl-1">.</span><span class="hl-7">delete</span><span class="hl-1">(</span><span class="hl-8">&#39;/customers&#39;</span><span class="hl-1">, </span><span class="hl-9">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-9">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">if</span><span class="hl-1">(!</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nif</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({</span><br/><span class="hl-1">            </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-8">&#39;NIF is required&#39;</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-6">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">customer</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-4">Customer</span><span class="hl-1">.</span><span class="hl-7">findOneAndDelete</span><span class="hl-1">({ </span><span class="hl-4">nif:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">.</span><span class="hl-4">nif</span><span class="hl-1"> });</span><br/><span class="hl-1">        </span><span class="hl-6">if</span><span class="hl-1">(!</span><span class="hl-4">customer</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><br/><span class="hl-1">                </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-8">&#39;Customer not found&#39;</span><span class="hl-1"> </span><br/><span class="hl-1">            });</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">customer</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-6">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">customerRouter</span><span class="hl-1">.</span><span class="hl-7">delete</span><span class="hl-1">(</span><span class="hl-8">&#39;/customers/:id&#39;</span><span class="hl-1">, </span><span class="hl-9">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-9">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">customer</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-4">Customer</span><span class="hl-1">.</span><span class="hl-7">findByIdAndDelete</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-6">if</span><span class="hl-1">(!</span><span class="hl-4">customer</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><br/><span class="hl-1">                </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-8">&#39;Customer not found&#39;</span><span class="hl-1"> </span><br/><span class="hl-1">            });</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">customer</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-6">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<ul>
<li><p><strong>furniture_router.ts</strong></p>
</li>
<li><p><code>POST /furnitures</code>: Permite crear un nuevo mueble en la base de datos. Recibe los datos del mueble en el cuerpo de la solicitud (name, description, material, color, price, type, stock) y crea una nueva instancia del modelo Furniture con estos datos. Luego, guarda este objeto en la base de datos. Si el guardado tiene éxito, responde con un estado 201 junto con los datos del mueble creado, en caso contrario, devuelve un estado 500 con un mensaje de error.</p>
</li>
</ul>
<pre><code><span class="hl-4">furnitureRouter</span><span class="hl-1">.</span><span class="hl-7">post</span><span class="hl-1">(</span><span class="hl-8">&#39;/furnitures&#39;</span><span class="hl-1">, </span><span class="hl-9">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-9">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">furniture</span><span class="hl-1"> = </span><span class="hl-9">new</span><span class="hl-1"> </span><span class="hl-7">Furniture</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-4">furniture</span><span class="hl-1">.</span><span class="hl-7">save</span><span class="hl-1">();</span><br/><span class="hl-1">        </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">201</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">furniture</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-6">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<ul>
<li><code>PATCH /furnitures</code>: Permite la actualización de múltiples muebles basándose en los filtros aplicados a través de los parámetros de consulta. La ruta valida que los campos actualizados estén dentro de los permitidos (name, description, material, color, price, type, stock) y, si se encuentran coincidencias, actualiza los artículos correspondientes. La respuesta incluirá un mensaje con el número de artículos actualizados o un estado 404 si ningún artículo coincide con los filtros, y un estado 500 si ocurre algún error en el proceso.</li>
</ul>
<pre><code><span class="hl-4">furnitureRouter</span><span class="hl-1">.</span><span class="hl-7">patch</span><span class="hl-1">(</span><span class="hl-8">&#39;/furnitures&#39;</span><span class="hl-1">, </span><span class="hl-9">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-9">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// eslint-disable-next-line @typescript-eslint/no-explicit-any</span><br/><span class="hl-1">    </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">filter</span><span class="hl-1">: </span><span class="hl-10">Record</span><span class="hl-1">&lt;</span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-10">any</span><span class="hl-1">&gt;  = {};</span><br/><span class="hl-1">    [</span><span class="hl-8">&#39;name&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;description&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;material&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;color&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;price&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;type&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;stock&#39;</span><span class="hl-1">].</span><span class="hl-7">forEach</span><span class="hl-1">((</span><span class="hl-4">field</span><span class="hl-1">) </span><span class="hl-9">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-6">if</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">[</span><span class="hl-4">field</span><span class="hl-1">]) {</span><br/><span class="hl-1">            </span><span class="hl-4">filter</span><span class="hl-1">[</span><span class="hl-4">field</span><span class="hl-1">] = </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">[</span><span class="hl-4">field</span><span class="hl-1">];</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">    });</span><br/><br/><span class="hl-1">    </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-4">Object</span><span class="hl-1">.</span><span class="hl-7">keys</span><span class="hl-1">(</span><span class="hl-4">filter</span><span class="hl-1">).</span><span class="hl-4">length</span><span class="hl-1"> === </span><span class="hl-2">0</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-8">&#39;At least one query parameter is required for filtering&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">updates</span><span class="hl-1"> = </span><span class="hl-4">Object</span><span class="hl-1">.</span><span class="hl-7">keys</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">allowedUpdates</span><span class="hl-1"> = [</span><span class="hl-8">&#39;name&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;description&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;material&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;color&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;price&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;type&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;stock&#39;</span><span class="hl-1">];</span><br/><span class="hl-1">    </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">isValidUpdate</span><span class="hl-1"> = </span><span class="hl-4">updates</span><span class="hl-1">.</span><span class="hl-7">every</span><span class="hl-1">(</span><span class="hl-4">update</span><span class="hl-1"> </span><span class="hl-9">=&gt;</span><span class="hl-1"> </span><span class="hl-4">allowedUpdates</span><span class="hl-1">.</span><span class="hl-7">includes</span><span class="hl-1">(</span><span class="hl-4">update</span><span class="hl-1">));</span><br/><br/><span class="hl-1">    </span><span class="hl-6">if</span><span class="hl-1"> (!</span><span class="hl-4">isValidUpdate</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-8">&#39;Invalid update&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-6">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">updated</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-4">Furniture</span><span class="hl-1">.</span><span class="hl-7">updateMany</span><span class="hl-1">(</span><span class="hl-4">filter</span><span class="hl-1">, </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">, { </span><span class="hl-4">new:</span><span class="hl-1"> </span><span class="hl-9">true</span><span class="hl-1">, </span><span class="hl-4">runValidators:</span><span class="hl-1"> </span><span class="hl-9">true</span><span class="hl-1"> });</span><br/><span class="hl-1">        </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-4">updated</span><span class="hl-1">.</span><span class="hl-4">modifiedCount</span><span class="hl-1"> === </span><span class="hl-2">0</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-8">&#39;Furniture not found&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">200</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({</span><br/><span class="hl-1">            </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-8">`</span><span class="hl-9">${</span><span class="hl-4">updated</span><span class="hl-15">.</span><span class="hl-4">modifiedCount</span><span class="hl-9">}</span><span class="hl-8"> furniture(s) updated`</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">    } </span><span class="hl-6">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<ul>
<li><code>PATCH /furnitures/:id</code>: Esta ruta actualiza un único mueble identificado por su ID de MongoDB. Acepta cambios en los mismos campos permitidos en la actualización general y utiliza el método <strong>findByIdAndUpdate</strong>. Si la actualización es exitosa, devuelve el mueble actualizado; si el mueble no se encuentra, retorna un estado 404; y si surge algún error durante la actualización, se emite un estado 500.</li>
</ul>
<pre><code><span class="hl-4">furnitureRouter</span><span class="hl-1">.</span><span class="hl-7">patch</span><span class="hl-1">(</span><span class="hl-8">&#39;/furnitures/:id&#39;</span><span class="hl-1">, </span><span class="hl-9">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-9">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">allowedUpdates</span><span class="hl-1"> = [</span><span class="hl-8">&#39;name&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;description&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;material&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;color&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;price&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;type&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;stock&#39;</span><span class="hl-1">];</span><br/><span class="hl-1">    </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">actualUpdates</span><span class="hl-1"> = </span><span class="hl-4">Object</span><span class="hl-1">.</span><span class="hl-7">keys</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">isValidUpdate</span><span class="hl-1"> = </span><span class="hl-4">actualUpdates</span><span class="hl-1">.</span><span class="hl-7">every</span><span class="hl-1">((</span><span class="hl-4">update</span><span class="hl-1">) </span><span class="hl-9">=&gt;</span><span class="hl-1"> </span><span class="hl-4">allowedUpdates</span><span class="hl-1">.</span><span class="hl-7">includes</span><span class="hl-1">(</span><span class="hl-4">update</span><span class="hl-1">));</span><br/><br/><span class="hl-1">    </span><span class="hl-6">if</span><span class="hl-1">(!</span><span class="hl-4">isValidUpdate</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({</span><br/><span class="hl-1">            </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-8">&#39;Update is not allowed&#39;</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-6">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">furniture</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-4">Furniture</span><span class="hl-1">.</span><span class="hl-7">findByIdAndUpdate</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">, </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">, { </span><span class="hl-4">new:</span><span class="hl-1"> </span><span class="hl-9">true</span><span class="hl-1">, </span><span class="hl-4">runValidators:</span><span class="hl-1"> </span><span class="hl-9">true</span><span class="hl-1"> });</span><br/><span class="hl-1">        </span><span class="hl-6">if</span><span class="hl-1">(!</span><span class="hl-4">furniture</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><br/><span class="hl-1">                </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-8">&#39;Furniture not found&#39;</span><span class="hl-1"> </span><br/><span class="hl-1">            });</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">200</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">furniture</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-6">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<ul>
<li><code>GET /furnitures</code>: Recupera todos los muebles que coincidan con los filtros especificados en los parámetros de consulta. Si se encuentran muebles, los devuelve; si no hay coincidencias, devuelve un estado 404. Problemas durante la recuperación de los datos resultan en un estado 500.</li>
</ul>
<pre><code><span class="hl-4">furnitureRouter</span><span class="hl-1">.</span><span class="hl-7">get</span><span class="hl-1">(</span><span class="hl-8">&#39;/furnitures&#39;</span><span class="hl-1">, </span><span class="hl-9">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-9">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// eslint-disable-next-line @typescript-eslint/no-explicit-any</span><br/><span class="hl-1">    </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">filter</span><span class="hl-1">: </span><span class="hl-10">Record</span><span class="hl-1">&lt;</span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-10">any</span><span class="hl-1">&gt;  = {};</span><br/><span class="hl-1">    [</span><span class="hl-8">&#39;name&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;description&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;material&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;color&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;price&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;type&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;stock&#39;</span><span class="hl-1">].</span><span class="hl-7">forEach</span><span class="hl-1">((</span><span class="hl-4">field</span><span class="hl-1">) </span><span class="hl-9">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-6">if</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">[</span><span class="hl-4">field</span><span class="hl-1">]) {</span><br/><span class="hl-1">            </span><span class="hl-4">filter</span><span class="hl-1">[</span><span class="hl-4">field</span><span class="hl-1">] = </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">[</span><span class="hl-4">field</span><span class="hl-1">];</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">    });</span><br/><br/><span class="hl-1">    </span><span class="hl-6">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">furnitures</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-4">Furniture</span><span class="hl-1">.</span><span class="hl-7">find</span><span class="hl-1">(</span><span class="hl-4">filter</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-6">if</span><span class="hl-1">(</span><span class="hl-4">furnitures</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> === </span><span class="hl-2">0</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><br/><span class="hl-1">                </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-8">&#39;Furniture not found&#39;</span><span class="hl-1"> </span><br/><span class="hl-1">            });</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">furnitures</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-6">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<ul>
<li><code>GET /furnitures/:id</code>: Obtiene los detalles de un mueble específico mediante <strong>findById</strong>, utilizando su ID de MongoDB. Si el mueble se encuentra, se devuelven sus detalles; de lo contrario, se responde con un estado 404. Cualquier error en la recuperación del mueble provoca un estado 500.</li>
</ul>
<pre><code><span class="hl-4">furnitureRouter</span><span class="hl-1">.</span><span class="hl-7">get</span><span class="hl-1">(</span><span class="hl-8">&#39;/furnitures/:id&#39;</span><span class="hl-1">, </span><span class="hl-9">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-9">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">furniture</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-4">Furniture</span><span class="hl-1">.</span><span class="hl-7">findById</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-6">if</span><span class="hl-1">(!</span><span class="hl-4">furniture</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><br/><span class="hl-1">                </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-8">&#39;Furniture not found&#39;</span><span class="hl-1"> </span><br/><span class="hl-1">            });</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">furniture</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-6">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<ul>
<li><code>DELETE /furnitures</code>: Permite eliminar muebles basándose en filtros especificados en los parámetros de consulta. Esta ruta verifica primero si los filtros están correctamente especificados y, si procede, elimina los muebles que coincidan mediante <strong>deleteMany</strong>. Devuelve un mensaje indicando la cantidad de muebles eliminados o un estado 404 si no se encuentra ningún mueble. Un error durante el proceso resulta en un estado 500.</li>
</ul>
<pre><code><span class="hl-4">furnitureRouter</span><span class="hl-1">.</span><span class="hl-7">delete</span><span class="hl-1">(</span><span class="hl-8">&#39;/furnitures&#39;</span><span class="hl-1">, </span><span class="hl-9">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-9">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// eslint-disable-next-line @typescript-eslint/no-explicit-any</span><br/><span class="hl-1">    </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">filter</span><span class="hl-1">: </span><span class="hl-10">Record</span><span class="hl-1">&lt;</span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-10">any</span><span class="hl-1">&gt;  = {};</span><br/><span class="hl-1">    [</span><span class="hl-8">&#39;name&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;description&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;material&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;color&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;price&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;type&#39;</span><span class="hl-1">, </span><span class="hl-8">&#39;stock&#39;</span><span class="hl-1">].</span><span class="hl-7">forEach</span><span class="hl-1">((</span><span class="hl-4">field</span><span class="hl-1">) </span><span class="hl-9">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-6">if</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">[</span><span class="hl-4">field</span><span class="hl-1">]) {</span><br/><span class="hl-1">            </span><span class="hl-4">filter</span><span class="hl-1">[</span><span class="hl-4">field</span><span class="hl-1">] = </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">[</span><span class="hl-4">field</span><span class="hl-1">];</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">    });</span><br/><br/><span class="hl-1">    </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-4">Object</span><span class="hl-1">.</span><span class="hl-7">keys</span><span class="hl-1">(</span><span class="hl-4">filter</span><span class="hl-1">).</span><span class="hl-4">length</span><span class="hl-1"> === </span><span class="hl-2">0</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-8">&#39;At least one query parameter is required for filtering&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-6">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">deleted</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-4">Furniture</span><span class="hl-1">.</span><span class="hl-7">deleteMany</span><span class="hl-1">(</span><span class="hl-4">filter</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-6">if</span><span class="hl-1">(</span><span class="hl-4">deleted</span><span class="hl-1">.</span><span class="hl-4">deletedCount</span><span class="hl-1"> === </span><span class="hl-2">0</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><br/><span class="hl-1">                </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-8">&#39;Furniture not found&#39;</span><span class="hl-1"> </span><br/><span class="hl-1">            });</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">send</span><span class="hl-1">({</span><br/><span class="hl-1">            </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-8">`</span><span class="hl-9">${</span><span class="hl-4">deleted</span><span class="hl-15">.</span><span class="hl-4">deletedCount</span><span class="hl-9">}</span><span class="hl-8"> furniture(s) deleted`</span><br/><span class="hl-1">        }).</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">200</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-6">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<ul>
<li><code>DELETE /furnitures/:id</code>: Elimina un mueble específico identificado por su ID de MongoDB a través de <strong>findByIdAndDelte</strong>. Si la eliminación es exitosa, devuelve los detalles del mueble eliminado; si no se encuentra el mueble, retorna un estado 404; y si ocurre un error durante la eliminación, se reporta con un estado 500.</li>
</ul>
<pre><code><span class="hl-4">furnitureRouter</span><span class="hl-1">.</span><span class="hl-7">delete</span><span class="hl-1">(</span><span class="hl-8">&#39;/furnitures/:id&#39;</span><span class="hl-1">, </span><span class="hl-9">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-9">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">furniture</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-4">Furniture</span><span class="hl-1">.</span><span class="hl-7">findByIdAndDelete</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-6">if</span><span class="hl-1">(!</span><span class="hl-4">furniture</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><br/><span class="hl-1">                </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-8">&#39;Furniture not found&#39;</span><span class="hl-1"> </span><br/><span class="hl-1">            });</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">furniture</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-6">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<ul>
<li><strong>transaction_router.ts</strong></li>
</ul>
<p>En primer lugar, tenemos las funciones <code>findCustomer</code> y <code>findProvider</code>, las cuales se encargan de verificar la existencia y la validez de clientes y proveedores dentro de la aplicación:</p>
<pre><code><span class="hl-9">async</span><span class="hl-1"> </span><span class="hl-9">function</span><span class="hl-1"> </span><span class="hl-7">findCustomer</span><span class="hl-1">(</span><span class="hl-4">nif</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">): </span><span class="hl-10">Promise</span><span class="hl-1">&lt;</span><span class="hl-10">CustomerDocumentInterface</span><span class="hl-1"> | </span><span class="hl-10">null</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">Customer</span><span class="hl-1">.</span><span class="hl-7">findOne</span><span class="hl-1">({ </span><span class="hl-4">nif:</span><span class="hl-1"> </span><span class="hl-4">nif</span><span class="hl-1"> }).</span><span class="hl-7">exec</span><span class="hl-1">();</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-9">async</span><span class="hl-1"> </span><span class="hl-9">function</span><span class="hl-1"> </span><span class="hl-7">findProvider</span><span class="hl-1">(</span><span class="hl-4">cif</span><span class="hl-1">: </span><span class="hl-10">string</span><span class="hl-1">): </span><span class="hl-10">Promise</span><span class="hl-1">&lt;</span><span class="hl-10">ProviderDocumentInterface</span><span class="hl-1"> | </span><span class="hl-10">null</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">    </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">Provider</span><span class="hl-1">.</span><span class="hl-7">findOne</span><span class="hl-1">({ </span><span class="hl-4">cif:</span><span class="hl-1"> </span><span class="hl-4">cif</span><span class="hl-1"> }).</span><span class="hl-7">exec</span><span class="hl-1">();</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>A continuación, los diferentes manejadores:</p>
<ul>
<li><code>POST /transactions</code>: Esta ruta crea nuevas transacciones, ya sean de tipo &quot;SALE&quot; o &quot;PURCHASE&quot;. Para iniciar una transacción, se requiere un <strong>type</strong> válido, una <strong>furnitureList</strong> con sus respectivos muebles y cantidades y, dependiendo del tipo de transacción, un NIF de cliente o un CIF de proveedor. La ruta primero verifica la validez del tipo de transacción y la presencia de la lista de muebles. Posteriormente, dependiendo del tipo, busca al cliente o al proveedor utilizando las funciones <strong>findCustomer</strong> o <strong>findProvider</strong>. Tras verificar la existencia y disponibilidad de los muebles, ajusta el inventario y calcula el precio total. Si todos los pasos se completan exitosamente, la transacción se guarda y se devuelve al cliente; si ocurre un error en cualquiera de estos pasos, se maneja adecuadamente, devolviendo mensajes de error específicos.</li>
</ul>
<pre><code><span class="hl-4">transactionRouter</span><span class="hl-1">.</span><span class="hl-7">post</span><span class="hl-1">(</span><span class="hl-8">&#39;/transactions&#39;</span><span class="hl-1">, </span><span class="hl-9">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-9">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-9">const</span><span class="hl-1"> { </span><span class="hl-0">type</span><span class="hl-1">, </span><span class="hl-0">customerNIF</span><span class="hl-1">, </span><span class="hl-0">providerCIF</span><span class="hl-1">, </span><span class="hl-0">furnitureList</span><span class="hl-1"> } = </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">;</span><br/><br/><span class="hl-1">    </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-4">type</span><span class="hl-1"> !== </span><span class="hl-8">&#39;SALE&#39;</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">type</span><span class="hl-1"> !== </span><span class="hl-8">&#39;PURCHASE&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-8">&#39;Invalid transaction type&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-6">if</span><span class="hl-1"> (!</span><span class="hl-4">furnitureList</span><span class="hl-1"> || </span><span class="hl-4">furnitureList</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> === </span><span class="hl-2">0</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-8">&#39;Furniture list must be provided&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-6">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-9">let</span><span class="hl-1"> </span><span class="hl-4">party</span><span class="hl-1"> = </span><span class="hl-9">null</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-4">type</span><span class="hl-1"> === </span><span class="hl-8">&#39;SALE&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-6">if</span><span class="hl-1"> (!</span><span class="hl-4">customerNIF</span><span class="hl-1">) {</span><br/><span class="hl-1">                </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-8">&#39;Customer NIF is required for SALE transactions&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">            </span><span class="hl-4">party</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-7">findCustomer</span><span class="hl-1">(</span><span class="hl-4">customerNIF</span><span class="hl-1">);</span><br/><span class="hl-1">            </span><span class="hl-6">if</span><span class="hl-1"> (!</span><span class="hl-4">party</span><span class="hl-1">) {</span><br/><span class="hl-1">                </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-8">&#39;Customer not found&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">        } </span><span class="hl-6">else</span><span class="hl-1"> </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-4">type</span><span class="hl-1"> === </span><span class="hl-8">&#39;PURCHASE&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-6">if</span><span class="hl-1"> (!</span><span class="hl-4">providerCIF</span><span class="hl-1">) {</span><br/><span class="hl-1">                </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-8">&#39;Provider CIF is required for PURCHASE transactions&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">            </span><span class="hl-4">party</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-7">findProvider</span><span class="hl-1">(</span><span class="hl-4">providerCIF</span><span class="hl-1">);</span><br/><span class="hl-1">            </span><span class="hl-6">if</span><span class="hl-1"> (!</span><span class="hl-4">party</span><span class="hl-1">) {</span><br/><span class="hl-1">                </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-8">&#39;Supplier not found&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">        }</span><br/><br/><span class="hl-1">        </span><span class="hl-9">let</span><span class="hl-1"> </span><span class="hl-4">totalPrice</span><span class="hl-1"> = </span><span class="hl-2">0</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-6">for</span><span class="hl-1"> (</span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">item</span><span class="hl-1"> </span><span class="hl-9">of</span><span class="hl-1"> </span><span class="hl-4">furnitureList</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">furniture</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-4">Furniture</span><span class="hl-1">.</span><span class="hl-7">findById</span><span class="hl-1">(</span><span class="hl-4">item</span><span class="hl-1">.</span><span class="hl-4">furnitureId</span><span class="hl-1">);</span><br/><span class="hl-1">            </span><span class="hl-6">if</span><span class="hl-1"> (!</span><span class="hl-4">furniture</span><span class="hl-1">) {</span><br/><span class="hl-1">                </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-8">&#39;Furniture not found&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">            }</span><br/><br/><span class="hl-1">            </span><span class="hl-6">if</span><span class="hl-1"> ((</span><span class="hl-4">type</span><span class="hl-1"> === </span><span class="hl-8">&#39;SALE&#39;</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">furniture</span><span class="hl-1">.</span><span class="hl-4">stock</span><span class="hl-1"> &lt; </span><span class="hl-4">item</span><span class="hl-1">.</span><span class="hl-4">quantity</span><span class="hl-1">) || </span><br/><span class="hl-1">                (</span><span class="hl-4">type</span><span class="hl-1"> === </span><span class="hl-8">&#39;PURCHASE&#39;</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">item</span><span class="hl-1">.</span><span class="hl-4">quantity</span><span class="hl-1"> &lt; </span><span class="hl-2">0</span><span class="hl-1">)) {</span><br/><span class="hl-1">                </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-8">&#39;Insufficient stock for sale or invalid quantity for purchase&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">            }</span><br/><br/><span class="hl-1">            </span><span class="hl-4">furniture</span><span class="hl-1">.</span><span class="hl-4">stock</span><span class="hl-1"> += (</span><span class="hl-4">type</span><span class="hl-1"> === </span><span class="hl-8">&#39;PURCHASE&#39;</span><span class="hl-1"> ? </span><span class="hl-4">item</span><span class="hl-1">.</span><span class="hl-4">quantity</span><span class="hl-1"> : (-</span><span class="hl-4">item</span><span class="hl-1">.</span><span class="hl-4">quantity</span><span class="hl-1">));</span><br/><span class="hl-1">            </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-4">furniture</span><span class="hl-1">.</span><span class="hl-7">save</span><span class="hl-1">();</span><br/><span class="hl-1">            </span><span class="hl-4">totalPrice</span><span class="hl-1"> += </span><span class="hl-4">furniture</span><span class="hl-1">.</span><span class="hl-4">price</span><span class="hl-1"> * </span><span class="hl-4">item</span><span class="hl-1">.</span><span class="hl-4">quantity</span><span class="hl-1">;</span><br/><span class="hl-1">        }</span><br/><br/><span class="hl-1">        </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">transaction</span><span class="hl-1"> = </span><span class="hl-9">new</span><span class="hl-1"> </span><span class="hl-7">Transaction</span><span class="hl-1">({</span><br/><span class="hl-1">            </span><span class="hl-4">customerNIF:</span><span class="hl-1"> </span><span class="hl-4">type</span><span class="hl-1"> === </span><span class="hl-8">&#39;SALE&#39;</span><span class="hl-1"> ? </span><span class="hl-4">customerNIF</span><span class="hl-1"> : </span><span class="hl-9">undefined</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-4">providerCIF:</span><span class="hl-1"> </span><span class="hl-4">type</span><span class="hl-1"> === </span><span class="hl-8">&#39;PURCHASE&#39;</span><span class="hl-1"> ? </span><span class="hl-4">providerCIF</span><span class="hl-1"> : </span><span class="hl-9">undefined</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-4">type</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-4">furnitureList</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-4">totalPrice</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-4">date:</span><span class="hl-1"> </span><span class="hl-9">new</span><span class="hl-1"> </span><span class="hl-7">Date</span><span class="hl-1">()</span><br/><span class="hl-1">        });</span><br/><br/><span class="hl-1">        </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-4">transaction</span><span class="hl-1">.</span><span class="hl-7">save</span><span class="hl-1">();</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">201</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">transaction</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-6">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1">.</span><span class="hl-4">message</span><span class="hl-1"> });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<ul>
<li><code>GET /transactions</code>: Esta ruta recupera transacciones basándose en filtros específicos como el NIF del cliente o el CIF del proveedor. Verifica la existencia de estos identificadores y, de ser correctos, procede a filtrar y devolver todas las transacciones que coincidan. Si no se encuentran transacciones que cumplan con los criterios establecidos, se devuelve un mensaje de error.</li>
</ul>
<pre><code><span class="hl-4">transactionRouter</span><span class="hl-1">.</span><span class="hl-7">get</span><span class="hl-1">(</span><span class="hl-8">&#39;/transactions&#39;</span><span class="hl-1">, </span><span class="hl-9">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-9">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-9">const</span><span class="hl-1"> { </span><span class="hl-0">customerNIF</span><span class="hl-1">, </span><span class="hl-0">providerCIF</span><span class="hl-1"> } = </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-5">// eslint-disable-next-line @typescript-eslint/no-explicit-any</span><br/><span class="hl-1">    </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">filter</span><span class="hl-1">: </span><span class="hl-10">Record</span><span class="hl-1">&lt;</span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-10">any</span><span class="hl-1">&gt; = {};</span><br/><span class="hl-1">    </span><span class="hl-6">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-4">customerNIF</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">customerExists</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-4">Customer</span><span class="hl-1">.</span><span class="hl-7">exists</span><span class="hl-1">({ </span><span class="hl-4">nif:</span><span class="hl-1"> </span><span class="hl-4">customerNIF</span><span class="hl-1"> });</span><br/><span class="hl-1">            </span><span class="hl-6">if</span><span class="hl-1"> (!</span><span class="hl-4">customerExists</span><span class="hl-1">) {</span><br/><span class="hl-1">                </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-8">`No customer found with NIF: </span><span class="hl-9">${</span><span class="hl-4">customerNIF</span><span class="hl-9">}</span><span class="hl-8">`</span><span class="hl-1"> });</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">        }</span><br/><br/><span class="hl-1">        </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-4">providerCIF</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">providerExists</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-4">Provider</span><span class="hl-1">.</span><span class="hl-7">exists</span><span class="hl-1">({ </span><span class="hl-4">cif:</span><span class="hl-1"> </span><span class="hl-4">providerCIF</span><span class="hl-1"> });</span><br/><span class="hl-1">            </span><span class="hl-6">if</span><span class="hl-1"> (!</span><span class="hl-4">providerExists</span><span class="hl-1">) {</span><br/><span class="hl-1">                </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-8">`No provider found with CIF: </span><span class="hl-9">${</span><span class="hl-4">providerCIF</span><span class="hl-9">}</span><span class="hl-8">`</span><span class="hl-1"> });</span><br/><span class="hl-1">            }</span><br/><span class="hl-1">        }</span><br/><br/><span class="hl-1">        </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-4">customerNIF</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-4">filter</span><span class="hl-1">.</span><span class="hl-4">customerNIF</span><span class="hl-1"> = </span><span class="hl-4">customerNIF</span><span class="hl-1">;</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-4">providerCIF</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-4">filter</span><span class="hl-1">.</span><span class="hl-4">providerCIF</span><span class="hl-1"> = </span><span class="hl-4">providerCIF</span><span class="hl-1">;</span><br/><span class="hl-1">        }</span><br/><br/><span class="hl-1">        </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">transactions</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-4">Transaction</span><span class="hl-1">.</span><span class="hl-7">find</span><span class="hl-1">(</span><span class="hl-4">filter</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-4">transactions</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> === </span><span class="hl-2">0</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-8">&#39;No transactions found for the provided identifiers.&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">200</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">transactions</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-6">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1">.</span><span class="hl-4">message</span><span class="hl-1"> });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<ul>
<li><code>GET /transactions/by-date</code>: Similar a la ruta anterior, esta variante permite filtrar transacciones dentro de un rango de fechas específico, además de por tipo de transacción. Valida la presencia de ambas fechas y el tipo, luego busca y devuelve todas las transacciones que cumplan con estos parámetros.</li>
</ul>
<pre><code><span class="hl-4">transactionRouter</span><span class="hl-1">.</span><span class="hl-7">get</span><span class="hl-1">(</span><span class="hl-8">&#39;/transactions/by-date&#39;</span><span class="hl-1">, </span><span class="hl-9">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-9">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-9">const</span><span class="hl-1"> { </span><span class="hl-0">startDate</span><span class="hl-1">, </span><span class="hl-0">endDate</span><span class="hl-1">, </span><span class="hl-0">type</span><span class="hl-1"> } = </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">query</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-5">// eslint-disable-next-line @typescript-eslint/no-explicit-any</span><br/><span class="hl-1">    </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">filter</span><span class="hl-1">: </span><span class="hl-10">Record</span><span class="hl-1">&lt;</span><span class="hl-10">string</span><span class="hl-1">, </span><span class="hl-10">any</span><span class="hl-1">&gt; = {};</span><br/><br/><span class="hl-1">    </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-4">type</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">filter</span><span class="hl-1">.</span><span class="hl-4">type</span><span class="hl-1"> = </span><span class="hl-4">type</span><span class="hl-1">;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-6">if</span><span class="hl-1">(</span><span class="hl-4">startDate</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">endDate</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">filter</span><span class="hl-1">.</span><span class="hl-4">date</span><span class="hl-1"> = { </span><span class="hl-4">$gte:</span><span class="hl-1"> </span><span class="hl-9">new</span><span class="hl-1"> </span><span class="hl-7">Date</span><span class="hl-1">(</span><span class="hl-4">startDate</span><span class="hl-1"> </span><span class="hl-6">as</span><span class="hl-1"> </span><span class="hl-10">string</span><span class="hl-1">), </span><span class="hl-4">$lte:</span><span class="hl-1"> </span><span class="hl-9">new</span><span class="hl-1"> </span><span class="hl-7">Date</span><span class="hl-1">(</span><span class="hl-4">endDate</span><span class="hl-1"> </span><span class="hl-6">as</span><span class="hl-1"> </span><span class="hl-10">string</span><span class="hl-1">) };</span><br/><span class="hl-1">    } </span><span class="hl-6">else</span><span class="hl-1"> </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-4">startDate</span><span class="hl-1"> || </span><span class="hl-4">endDate</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-8">&#39;Both start date and end date must be provided&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-6">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">transactions</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-4">Transaction</span><span class="hl-1">.</span><span class="hl-7">find</span><span class="hl-1">(</span><span class="hl-4">filter</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-4">transactions</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> === </span><span class="hl-2">0</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-8">&#39;No transactions found&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">200</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">transactions</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-6">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1">.</span><span class="hl-4">message</span><span class="hl-1"> });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<ul>
<li><code>GET /transactions/:id</code>: Obtiene los datos de una transacción usando su ID de MongoDB. Utiliza <strong>findById</strong> para buscar la transacción, devolviendo sus datos en caso de éxito, o un error 404 si no se encuentra la transacción, y un error 500 en caso de problemas durante la operación.</li>
</ul>
<pre><code><span class="hl-4">transactionRouter</span><span class="hl-1">.</span><span class="hl-7">get</span><span class="hl-1">(</span><span class="hl-8">&#39;/transactions/:id&#39;</span><span class="hl-1">, </span><span class="hl-9">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-9">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">transaction</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-4">Transaction</span><span class="hl-1">.</span><span class="hl-7">findById</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-6">if</span><span class="hl-1"> (!</span><span class="hl-4">transaction</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><br/><span class="hl-1">                </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-8">&#39;Transaction not found&#39;</span><span class="hl-1"> </span><br/><span class="hl-1">            });</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">transaction</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-6">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1">.</span><span class="hl-4">message</span><span class="hl-1"> });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<ul>
<li><code>PATCH /transactions/:id</code>: Permite la actualización de una transacción específica mediante su ID de MongoDB. Primero, se verifica si la transacción existe utilizando el ID proporcionado. Si no se encuentra, se responde con un estado HTTP 404. Luego se examina la lista de muebles actualizada proporcionada en el cuerpo de la solicitud y se asegura que los muebles existan y que las cantidades sean adecuadas para el tipo de transacción (venta o compra). Para cada mueble implicado, se ajusta el stock. Para ventas, el stock se reduce; para compras, se incrementa.
El precio total de la transacción se recalcula basándose en los precios actuales de los muebles y las nuevas cantidades. 
Por último, los detalles de la transacción actualizados, incluyendo la lista de muebles y el precio total, se guardan nuevamente en la base de datos. Si todo el proceso es exitoso, se envía la transacción actualizada al cliente. En caso de errores durante la actualización, como problemas de validación o errores en el acceso a la base de datos, se manejan mediante códigos de estado apropiados y mensajes de error claros.</li>
</ul>
<pre><code><span class="hl-4">transactionRouter</span><span class="hl-1">.</span><span class="hl-7">patch</span><span class="hl-1">(</span><span class="hl-8">&#39;/transactions/:id&#39;</span><span class="hl-1">, </span><span class="hl-9">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-9">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-9">const</span><span class="hl-1"> { </span><span class="hl-0">id</span><span class="hl-1"> } = </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-9">const</span><span class="hl-1"> { </span><span class="hl-0">furnitureList</span><span class="hl-1"> } = </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">;</span><br/><br/><span class="hl-1">    </span><span class="hl-6">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">transaction</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-4">Transaction</span><span class="hl-1">.</span><span class="hl-7">findById</span><span class="hl-1">(</span><span class="hl-4">id</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-6">if</span><span class="hl-1"> (!</span><span class="hl-4">transaction</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-8">&#39;Transaction not found.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><br/><span class="hl-1">        </span><span class="hl-9">let</span><span class="hl-1"> </span><span class="hl-4">newTotalPrice</span><span class="hl-1"> = </span><span class="hl-2">0</span><span class="hl-1">;</span><br/><br/><span class="hl-1">        </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-4">transaction</span><span class="hl-1">.</span><span class="hl-4">furnitureList</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">transaction</span><span class="hl-1">.</span><span class="hl-4">furnitureList</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> &gt; </span><span class="hl-2">0</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-10">Promise</span><span class="hl-1">.</span><span class="hl-7">all</span><span class="hl-1">(</span><span class="hl-4">transaction</span><span class="hl-1">.</span><span class="hl-4">furnitureList</span><span class="hl-1">.</span><span class="hl-7">map</span><span class="hl-1">(</span><span class="hl-9">async</span><span class="hl-1"> (</span><span class="hl-4">item</span><span class="hl-1">) </span><span class="hl-9">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">furniture</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-4">Furniture</span><span class="hl-1">.</span><span class="hl-7">findById</span><span class="hl-1">(</span><span class="hl-4">item</span><span class="hl-1">.</span><span class="hl-4">furnitureId</span><span class="hl-1">);</span><br/><span class="hl-1">                </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-4">furniture</span><span class="hl-1">) {</span><br/><span class="hl-1">                    </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">stockAdjustment</span><span class="hl-1"> = </span><span class="hl-4">transaction</span><span class="hl-1">.</span><span class="hl-4">type</span><span class="hl-1"> === </span><span class="hl-8">&#39;PURCHASE&#39;</span><span class="hl-1"> ? -</span><span class="hl-4">item</span><span class="hl-1">.</span><span class="hl-4">quantity</span><span class="hl-1"> : </span><span class="hl-4">item</span><span class="hl-1">.</span><span class="hl-4">quantity</span><span class="hl-1">;</span><br/><span class="hl-1">                    </span><span class="hl-4">furniture</span><span class="hl-1">.</span><span class="hl-4">stock</span><span class="hl-1"> += </span><span class="hl-4">stockAdjustment</span><span class="hl-1">;</span><br/><span class="hl-1">                    </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-4">furniture</span><span class="hl-1">.</span><span class="hl-7">save</span><span class="hl-1">();</span><br/><span class="hl-1">                }</span><br/><span class="hl-1">            }));</span><br/><span class="hl-1">        }</span><br/><br/><span class="hl-1">        </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-4">furnitureList</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">furnitureList</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1"> &gt; </span><span class="hl-2">0</span><span class="hl-1">) {</span><br/><span class="hl-1">            </span><span class="hl-5">// eslint-disable-next-line @typescript-eslint/no-explicit-any</span><br/><span class="hl-1">            </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-10">Promise</span><span class="hl-1">.</span><span class="hl-7">all</span><span class="hl-1">(</span><span class="hl-4">furnitureList</span><span class="hl-1">.</span><span class="hl-7">map</span><span class="hl-1">(</span><span class="hl-9">async</span><span class="hl-1"> (</span><span class="hl-4">newItem</span><span class="hl-1">: { </span><span class="hl-4">furnitureId</span><span class="hl-1">: </span><span class="hl-10">any</span><span class="hl-1">; </span><span class="hl-4">quantity</span><span class="hl-1">: </span><span class="hl-10">number</span><span class="hl-1">; }) </span><span class="hl-9">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">                </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">furniture</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-4">Furniture</span><span class="hl-1">.</span><span class="hl-7">findById</span><span class="hl-1">(</span><span class="hl-4">newItem</span><span class="hl-1">.</span><span class="hl-4">furnitureId</span><span class="hl-1">);</span><br/><span class="hl-1">                </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-4">furniture</span><span class="hl-1">) {</span><br/><span class="hl-1">                    </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">stockAdjustment</span><span class="hl-1"> = </span><span class="hl-4">transaction</span><span class="hl-1">.</span><span class="hl-4">type</span><span class="hl-1"> === </span><span class="hl-8">&#39;PURCHASE&#39;</span><span class="hl-1"> ? </span><span class="hl-4">newItem</span><span class="hl-1">.</span><span class="hl-4">quantity</span><span class="hl-1"> : -</span><span class="hl-4">newItem</span><span class="hl-1">.</span><span class="hl-4">quantity</span><span class="hl-1">;</span><br/><span class="hl-1">                    </span><span class="hl-4">furniture</span><span class="hl-1">.</span><span class="hl-4">stock</span><span class="hl-1"> += </span><span class="hl-4">stockAdjustment</span><span class="hl-1">;</span><br/><span class="hl-1">                    </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-4">furniture</span><span class="hl-1">.</span><span class="hl-7">save</span><span class="hl-1">();</span><br/><span class="hl-1">                    </span><span class="hl-4">newTotalPrice</span><span class="hl-1"> += </span><span class="hl-4">newItem</span><span class="hl-1">.</span><span class="hl-4">quantity</span><span class="hl-1"> * </span><span class="hl-4">furniture</span><span class="hl-1">.</span><span class="hl-4">price</span><span class="hl-1">;</span><br/><span class="hl-1">                } </span><span class="hl-6">else</span><span class="hl-1"> {</span><br/><span class="hl-1">                    </span><span class="hl-6">throw</span><span class="hl-1"> </span><span class="hl-9">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-8">`Furniture not found for ID: </span><span class="hl-9">${</span><span class="hl-4">newItem</span><span class="hl-15">.</span><span class="hl-4">furnitureId</span><span class="hl-9">}</span><span class="hl-8">`</span><span class="hl-1">);</span><br/><span class="hl-1">                }</span><br/><span class="hl-1">            }));</span><br/><span class="hl-1">        }</span><br/><br/><span class="hl-1">        </span><span class="hl-4">transaction</span><span class="hl-1">.</span><span class="hl-4">furnitureList</span><span class="hl-1"> = </span><span class="hl-4">furnitureList</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-4">transaction</span><span class="hl-1">.</span><span class="hl-4">totalPrice</span><span class="hl-1"> = </span><span class="hl-4">newTotalPrice</span><span class="hl-1">; </span><br/><span class="hl-1">        </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-4">transaction</span><span class="hl-1">.</span><span class="hl-7">save</span><span class="hl-1">();</span><br/><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-4">transaction</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-6">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1">.</span><span class="hl-4">message</span><span class="hl-1"> });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<ul>
<li><code>DELETE /transactions/:id</code>: Inicialmente, se intenta encontrar la transacción específica utilizando el ID proporcionado en la solicitud (req.params.id) mediante el método <strong>findById</strong>. Una vez encontrada la transacción, el sistema revisa cada artículo listado en transaction.furnitureList. Para cada artículo, busca el mueble correspondiente en la base de datos utilizando su ID. Si algún mueble no se encuentra, devuelve un error 404 indicando que el mueble específico no fue encontrado, en cambio, si el mueble existe, calcula el nuevo nivel de stock que resultaría después de revertir la transacción. Si la transacción fue una compra, se reduce el stock, si fue una venta, se incrementa.
Si el ajuste de stock resulta en un número negativo, lo que indicaría una cantidad inexistente, se devuelve un error 400 indicando insuficiencia de stock para revertir la transacción.
Después de ajustar el inventario de todos los artículos involucrados sin problemas, la transacción se elimina de la base de datos utilizando <strong>findByIdAndDelete</strong>. Si todos los pasos anteriores se completan con éxito, se envía una respuesta con estado 200, indicando que la transacción fue eliminada correctamente y que el stock fue ajustado adecuadamente, en caso contrario, se captura este error y se devuelve un estado 500 con un mensaje explicativo.</li>
</ul>
<pre><code><span class="hl-4">transactionRouter</span><span class="hl-1">.</span><span class="hl-7">delete</span><span class="hl-1">(</span><span class="hl-8">&#39;/transactions/:id&#39;</span><span class="hl-1">, </span><span class="hl-9">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-9">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">transaction</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-4">Transaction</span><span class="hl-1">.</span><span class="hl-7">findById</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-6">if</span><span class="hl-1"> (!</span><span class="hl-4">transaction</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">(</span><span class="hl-8">&#39;Transaction not found&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">  </span><br/><span class="hl-1">      </span><span class="hl-6">for</span><span class="hl-1"> (</span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">item</span><span class="hl-1"> </span><span class="hl-9">of</span><span class="hl-1"> </span><span class="hl-4">transaction</span><span class="hl-1">.</span><span class="hl-4">furnitureList</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">furniture</span><span class="hl-1"> = </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-4">Furniture</span><span class="hl-1">.</span><span class="hl-7">findById</span><span class="hl-1">(</span><span class="hl-4">item</span><span class="hl-1">.</span><span class="hl-4">furnitureId</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-6">if</span><span class="hl-1"> (!</span><span class="hl-4">furniture</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">404</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-8">&#39;Furniture not found for ID: &#39;</span><span class="hl-1"> + </span><span class="hl-4">item</span><span class="hl-1">.</span><span class="hl-4">furnitureId</span><span class="hl-1"> });</span><br/><span class="hl-1">        }</span><br/><br/><span class="hl-1">        </span><span class="hl-9">const</span><span class="hl-1"> </span><span class="hl-0">newStockLevel</span><span class="hl-1"> = </span><span class="hl-4">transaction</span><span class="hl-1">.</span><span class="hl-4">type</span><span class="hl-1"> === </span><span class="hl-8">&#39;PURCHASE&#39;</span><span class="hl-1"> ? </span><span class="hl-4">furniture</span><span class="hl-1">.</span><span class="hl-4">stock</span><span class="hl-1"> - </span><span class="hl-4">item</span><span class="hl-1">.</span><span class="hl-4">quantity</span><span class="hl-1"> : </span><span class="hl-4">furniture</span><span class="hl-1">.</span><span class="hl-4">stock</span><span class="hl-1"> + </span><span class="hl-4">item</span><span class="hl-1">.</span><span class="hl-4">quantity</span><span class="hl-1">;</span><br/><br/><span class="hl-1">        </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-4">newStockLevel</span><span class="hl-1"> &lt; </span><span class="hl-2">0</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">400</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({</span><br/><span class="hl-1">            </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-8">`Insufficient stock to reverse the transaction for furniture ID: </span><span class="hl-9">${</span><span class="hl-4">item</span><span class="hl-15">.</span><span class="hl-4">furnitureId</span><span class="hl-9">}</span><span class="hl-8">. Available stock: </span><span class="hl-9">${</span><span class="hl-4">furniture</span><span class="hl-15">.</span><span class="hl-4">stock</span><span class="hl-9">}</span><span class="hl-8">, trying to subtract: </span><span class="hl-9">${</span><span class="hl-4">item</span><span class="hl-15">.</span><span class="hl-4">quantity</span><span class="hl-9">}</span><span class="hl-8">`</span><br/><span class="hl-1">          });</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">  </span><br/><span class="hl-1">        </span><span class="hl-4">furniture</span><span class="hl-1">.</span><span class="hl-4">stock</span><span class="hl-1"> = </span><span class="hl-4">newStockLevel</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-4">furniture</span><span class="hl-1">.</span><span class="hl-7">save</span><span class="hl-1">();</span><br/><span class="hl-1">      }</span><br/><br/><span class="hl-1">      </span><span class="hl-6">await</span><span class="hl-1"> </span><span class="hl-4">Transaction</span><span class="hl-1">.</span><span class="hl-7">findByIdAndDelete</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">params</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">200</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-8">&#39;Transaction deleted and stock adjusted successfully.&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">    } </span><span class="hl-6">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-7">status</span><span class="hl-1">(</span><span class="hl-2">500</span><span class="hl-1">).</span><span class="hl-7">send</span><span class="hl-1">({ </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-8">&#39;Error deleting transaction: &#39;</span><span class="hl-1"> + </span><span class="hl-4">error</span><span class="hl-1">.</span><span class="hl-4">message</span><span class="hl-1"> });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<a id="md:conclusiones" class="tsd-anchor"></a><h2><a href="#md:conclusiones">Conclusiones</a></h2><p>El desarrollo de este proyecto nos ha servido para poner en práctica los conocimientos adquiridos hasta ahora en la asignatura, mayoritariamente los de la segunda parte. Hemos aprendido a usar diferentes herramientas como el Framework Express, para implementar la API REST, así como MongoDB y Mongoose para trabajar con la base de datos y modelarlos de forma sencilla. También, a través de los servicios MongoDB Atlas y Render, hemos conseguido llevar a cabo el despliegue de nuestra primera apliación, adquiriendo así algo de experiencia en la gestión y puesta en marcha de aplicaciones en entornos de producción &quot;real&quot;.</p>
<p>La mayor dificultad de la práctica fue sin duda utilizar <strong>MongoDB Atlas</strong>, pues no podíamos conectarnos a la base de datos desde la extensión de MongoDB en VSCode. Supusimos que podía ser un problema o bien con las IPs, o bien con la VPN para conectarnos a la máquina virtual. Sin embargo, lo primero no podía ser, pues habíamos habilitado la IP <strong>0.0.0.0/0</strong>, así que supusimos que era lo segundo.
Para arreglarlo, simplemente desactivamos la VPN, clonamos el repositorio en local y una vez ahí, ya nos dejaba conectarnos a la base de datos y correr la aplicación sin problemas.</p>
<p>Por último, nos gustaría agradecer al profesor por el esfuerzo puesto en la creación de los apuntes, pues la claridad y el detalle con que están redactados, facilitaron significativamente nuestro aprendizaje.</p>
<a id="md:bibliografía" class="tsd-anchor"></a><h2><a href="#md:bibliografía">Bibliografía</a></h2><ul>
<li><a href="https://chat.openai.com/">ChatGPT</a></li>
<li><a href="https://www.freecodecamp.org/espanol/news/todo-lo-que-necesitas-saber-sobre-promise-all/">Promise.all</a></li>
<li><a href="https://www.mongodb.com/products/platform/atlas-database">MongoDB Atlas</a></li>
<li><a href="https://www.npmjs.com/package/mongoose">Mongoose</a></li>
<li><a href="https://render.com/">Render</a></li>
<li><a href="https://ull-esit-inf-dsi-2324.github.io/nodejs-theory/">Apuntes de la asignatura</a></li>
</ul>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-index-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><h4 class="uppercase">Member Visibility</h4><form><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div><div class="tsd-theme-toggle"><h4 class="uppercase">Theme</h4><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-index-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:práctica-13---dsikea-api-rest-con-nodeexpress"><span>Práctica 13 -<wbr/> DSIkea: API REST con <wbr/>Node/<wbr/>Express</span></a><ul><li><a href="#md:introducción-y-objetivos"><span>Introducción y objetivos</span></a></li><li><a href="#md:desarrollo"><span>Desarrollo</span></a></li><li><ul><li><a href="#md:srcdb"><span>[./src/db]</span></a></li><li><a href="#md:srcmodels"><span>[./src/models]</span></a></li><li><a href="#md:srcrouters"><span>[./src/routers]</span></a></li></ul></li><li><a href="#md:conclusiones"><span>Conclusiones</span></a></li><li><a href="#md:bibliografía"><span>Bibliografía</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>ull-esit-inf-dsi-23-24-prct13-dsikea-api-grouph</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>